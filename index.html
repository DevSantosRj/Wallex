<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallex - An√°lise Avan√ßada de Carteiras Blockchain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .form-input, .form-select {
            background-color: rgba(55, 65, 81, 0.8);
            border-color: #4B5563;
            color: white;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .form-input::placeholder {
            color: #9CA3AF;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(75, 85, 99, 0.8);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background-color: rgba(107, 114, 128, 0.9);
            transform: translateY(-1px);
        }
        
        .wallex-logo {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 800;
            margin-left: 16px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            letter-spacing: 1px;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        
        .token-info-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
        }
        
        .debug-panel {
            background: rgba(31, 41, 55, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #D1D5DB;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-line {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .debug-line:hover {
            background: rgba(55, 65, 81, 0.5);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .balance-highlight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
        }
        
        .analysis-mode-card {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(148, 163, 184, 0.2);
            transition: all 0.3s ease;
        }
        
        .analysis-mode-card:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: rgba(148, 163, 184, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .analysis-mode-card.active {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.3);
        }
        
        .analysis-mode-card.active:hover {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.7);
        }
    </style>
</head>
<body class="text-white">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <!-- Header -->
        <header class="text-center mb-8 fade-in">
            <div class="flex items-center justify-center mb-6">
                <div class="w-16 h-16 flex items-center justify-center mr-4">
                    <img src="wallex_logo_transparent.png" alt="Wallex Logo" class="w-16 h-16 object-contain" />
                </div>
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                        Wallex
                        <span class="wallex-logo">PRO</span>
                    </h1>
                </div>
            </div>
            <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-6">
                An√°lise unificada de transa√ß√µes em <strong>50+ redes blockchain</strong> com tecnologia avan√ßada e interface intuitiva
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                    <div class="text-green-400 font-bold text-lg">üîê Seguro & Privado</div>
                    <div class="text-green-300 text-sm">API integrada no backend</div>
                </div>
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                    <div class="text-blue-400 font-bold text-lg">üåê 50+ Redes</div>
                    <div class="text-blue-300 text-sm">Ethereum, BSC, Polygon e mais</div>
                </div>
                <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                    <div class="text-purple-400 font-bold text-lg">ü™ô Info Autom√°tica</div>
                    <div class="text-purple-300 text-sm">Detecta tokens automaticamente</div>
                </div>
            </div>
        </header>

        <!-- Seletor de Modo de An√°lise -->
        <div class="glass-card rounded-xl p-6 mb-8 fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-semibold text-gray-200 mb-4">Escolha o Tipo de An√°lise</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
                    <div id="walletModeCard" class="analysis-mode-card active cursor-pointer p-6 rounded-xl border-2 transition-all duration-300">
                        <div class="text-center">
                            <div class="w-16 h-16 mx-auto mb-4 bg-blue-500/20 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">An√°lise de Carteira</h3>
                            <p class="text-gray-400 text-sm">Analise transa√ß√µes de uma carteira espec√≠fica com filtros avan√ßados</p>
                        </div>
                    </div>
                    <div id="contractModeCard" class="analysis-mode-card cursor-pointer p-6 rounded-xl border-2 transition-all duration-300">
                        <div class="text-center">
                            <div class="w-16 h-16 mx-auto mb-4 bg-purple-500/20 rounded-full flex items-center justify-center">
                                <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <h3 class="text-xl font-bold text-white mb-2">An√°lise Global de Token</h3>
                            <p class="text-gray-400 text-sm">Analise todas as transa√ß√µes de um contrato de token e volume total</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Painel de Configura√ß√£o -->
        <div class="glass-card rounded-xl p-6 mb-8 fade-in">
            <div class="flex items-center mb-6">
                <h2 id="configTitle" class="text-2xl font-semibold text-gray-200">Configura√ß√£o da An√°lise de Carteira</h2>
                <div class="ml-auto">
                    <span class="text-sm text-green-400 bg-green-900/20 px-3 py-1 rounded-full border border-green-500/30">
                        ‚ú® API Integrada - Sem configura√ß√£o necess√°ria
                    </span>
                </div>
            </div>
            
            <!-- Configura√ß√£o para An√°lise de Carteira -->
            <div id="walletAnalysisConfig">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <label for="networkSelector" class="block text-lg font-medium text-gray-300 mb-4">
                            Selecione a Rede Blockchain
                            <span class="text-red-400">*</span>
                        </label>
                        <select id="networkSelector" class="form-select w-full rounded-lg shadow-lg p-4 text-lg" required>
                            <option value="eth" data-chainid="1">üî∑ Ethereum (ETH)</option>
                            <option value="bsc" data-chainid="56">üü° BNB Smart Chain (BNB)</option>
                            <option value="polygon" data-chainid="137">üü£ Polygon (MATIC)</option>
                            <option value="arbitrum" data-chainid="42161">üîµ Arbitrum One (ETH)</option>
                            <option value="optimism" data-chainid="10">üî¥ Optimism (ETH)</option>
                            <option value="avalanche" data-chainid="43114">üî∫ Avalanche C-Chain (AVAX)</option>
                            <option value="base" data-chainid="8453">üîµ Base (ETH)</option>
                            <option value="blast" data-chainid="81457">üí• Blast (ETH)</option>
                            <option value="scroll" data-chainid="534352">üìú Scroll (ETH)</option>
                            <option value="zksync" data-chainid="324">‚ö° zkSync Era (ETH)</option>
                            <option value="linea" data-chainid="59144">üîó Linea (ETH)</option>
                            <option value="mantle" data-chainid="5000">üß• Mantle (MNT)</option>
                        </select>
                        <div class="mt-2 text-sm text-blue-400">
                            üîê <strong>Seguro:</strong> API key integrada no backend para m√°xima seguran√ßa
                        </div>
                    </div>
                    <div>
                        <label for="walletAddress" class="block text-lg font-medium text-gray-300 mb-4">
                            Endere√ßo da Carteira (Wallet)
                            <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="walletAddress" class="form-input w-full rounded-lg shadow-lg p-4 text-lg" placeholder="0x..." required>
                        <div id="walletValidation" class="mt-2 text-sm hidden"></div>
                        <div class="mt-2 text-sm text-gray-400">
                            üí° <strong>Dica:</strong> Cole o endere√ßo da carteira que deseja analisar
                        </div>
                    </div>
                </div>
                
                <div class="mt-8">
                    <label for="tokenAddress" class="block text-lg font-medium text-gray-300 mb-4">
                        Endere√ßo do Token (Contrato) - Opcional
                    </label>
                    <input type="text" id="tokenAddress" class="form-input w-full rounded-lg shadow-lg p-4 text-lg" placeholder="Deixe em branco para transa√ß√µes da moeda nativa">
                    <div class="mt-2 text-sm text-green-400">
                        ü™ô <strong>Autom√°tico:</strong> Wallex detecta automaticamente nome, s√≠mbolo e saldo do token
                    </div>
                </div>
            </div>

            <!-- Configura√ß√£o para An√°lise Global de Token -->
            <div id="contractAnalysisConfig" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <label for="contractNetworkSelector" class="block text-lg font-medium text-gray-300 mb-4">
                            Selecione a Rede Blockchain
                            <span class="text-red-400">*</span>
                        </label>
                        <select id="contractNetworkSelector" class="form-select w-full rounded-lg shadow-lg p-4 text-lg" required>
                            <option value="eth" data-chainid="1">üî∑ Ethereum (ETH)</option>
                            <option value="bsc" data-chainid="56">üü° BNB Smart Chain (BNB)</option>
                            <option value="polygon" data-chainid="137">üü£ Polygon (MATIC)</option>
                            <option value="arbitrum" data-chainid="42161">üîµ Arbitrum One (ETH)</option>
                            <option value="optimism" data-chainid="10">üî¥ Optimism (ETH)</option>
                            <option value="avalanche" data-chainid="43114">üî∫ Avalanche C-Chain (AVAX)</option>
                            <option value="base" data-chainid="8453">üîµ Base (ETH)</option>
                            <option value="blast" data-chainid="81457">üí• Blast (ETH)</option>
                            <option value="scroll" data-chainid="534352">üìú Scroll (ETH)</option>
                            <option value="zksync" data-chainid="324">‚ö° zkSync Era (ETH)</option>
                            <option value="linea" data-chainid="59144">üîó Linea (ETH)</option>
                            <option value="mantle" data-chainid="5000">üß• Mantle (MNT)</option>
                        </select>
                        <div class="mt-2 text-sm text-blue-400">
                            üîê <strong>Seguro:</strong> API key integrada no backend para m√°xima seguran√ßa
                        </div>
                    </div>
                    <div>
                        <label for="contractAddressInput" class="block text-lg font-medium text-gray-300 mb-4">
                            Endere√ßo do Contrato do Token
                            <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="contractAddressInput" class="form-input w-full rounded-lg shadow-lg p-4 text-lg" placeholder="0x..." required>
                        <div id="contractValidation" class="mt-2 text-sm hidden"></div>
                        <div class="mt-2 text-sm text-purple-400">
                            üîç <strong>An√°lise Global:</strong> Todas as transa√ß√µes do token ser√£o analisadas
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 bg-purple-900/20 border border-purple-500/30 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-purple-400 mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Sobre a An√°lise Global de Token
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="flex items-start">
                            <div class="w-2 h-2 bg-purple-400 rounded-full mt-2 mr-3 flex-shrink-0"></div>
                            <div>
                                <div class="text-white font-medium">Volume Total de Entrada</div>
                                <div class="text-gray-400">Soma de todas as transa√ß√µes recebidas pelo contrato</div>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-2 h-2 bg-purple-400 rounded-full mt-2 mr-3 flex-shrink-0"></div>
                            <div>
                                <div class="text-white font-medium">Convers√£o Autom√°tica</div>
                                <div class="text-gray-400">Valores convertidos para USD e moeda nativa</div>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-2 h-2 bg-purple-400 rounded-full mt-2 mr-3 flex-shrink-0"></div>
                            <div>
                                <div class="text-white font-medium">An√°lise Completa</div>
                                <div class="text-gray-400">Todas as transa√ß√µes do token, n√£o limitado a carteiras</div>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-2 h-2 bg-purple-400 rounded-full mt-2 mr-3 flex-shrink-0"></div>
                            <div>
                                <div class="text-white font-medium">Estat√≠sticas Avan√ßadas</div>
                                <div class="text-gray-400">Holders √∫nicos, volume por per√≠odo, top transa√ß√µes</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filtros Avan√ßados -->
            <div class="mt-8">
                <button id="toggleFilters" class="btn-secondary text-white font-semibold py-3 px-6 rounded-lg flex items-center text-lg">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"></path>
                    </svg>
                    Filtros Avan√ßados
                </button>
            </div>
            
            <div id="advancedFilters" class="mt-6 hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="minValue" class="block text-sm font-medium text-gray-300 mb-2">Valor M√≠nimo</label>
                        <input type="number" id="minValue" class="form-input w-full rounded-lg shadow-sm p-3" placeholder="0.0" step="0.000001">
                    </div>
                    <div>
                        <label for="maxValue" class="block text-sm font-medium text-gray-300 mb-2">Valor M√°ximo</label>
                        <input type="number" id="maxValue" class="form-input w-full rounded-lg shadow-sm p-3" placeholder="Sem limite" step="0.000001">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div>
                        <label for="txType" class="block text-sm font-medium text-gray-300 mb-2">Tipo de Transa√ß√£o</label>
                        <select id="txType" class="form-select w-full rounded-lg shadow-sm p-3">
                            <option value="all">Todas</option>
                            <option value="incoming">Apenas Recebidas</option>
                            <option value="outgoing">Apenas Enviadas</option>
                        </select>
                    </div>
                    <div>
                        <label for="specificAddress" class="block text-sm font-medium text-gray-300 mb-2">Endere√ßo Espec√≠fico</label>
                        <input type="text" id="specificAddress" class="form-input w-full rounded-lg shadow-sm p-3" placeholder="Filtrar por endere√ßo">
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                <div>
                    <label for="startDate" class="block text-lg font-medium text-gray-300 mb-4">Data de In√≠cio</label>
                    <input type="date" id="startDate" class="form-input w-full rounded-lg shadow-lg p-4 text-lg">
                </div>
                <div>
                    <label for="endDate" class="block text-lg font-medium text-gray-300 mb-4">Data de Fim</label>
                    <input type="date" id="endDate" class="form-input w-full rounded-lg shadow-lg p-4 text-lg">
                </div>
            </div>
            
            <div class="mt-6 flex flex-wrap gap-3 items-center">
                <span class="text-lg font-medium text-gray-300 mr-3">Per√≠odos r√°pidos:</span>
                <button onclick="setPeriod(7)" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">√öltimos 7 dias</button>
                <button onclick="setPeriod(30)" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">√öltimos 30 dias</button>
                <button onclick="setPeriod(90)" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">√öltimos 90 dias</button>
                <button onclick="setPeriod(365)" class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg">√öltimo ano</button>
            </div>
            
            <div class="mt-8">
                <button id="analyzeBtn" class="btn-primary w-full text-white font-bold py-4 px-6 rounded-lg flex items-center justify-center text-xl">
                    <svg id="search-icon" class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-6 w-6 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span id="analyzeBtnText">Analisar com Wallex</span>
                </button>
            </div>
        </div>

        <!-- Debug Panel -->
        <div id="debugPanel" class="debug-panel hidden">
            <div class="flex items-center justify-between mb-4">
                <h4 class="font-bold text-lg text-blue-400">üîç Debug - Wallex em Tempo Real</h4>
                <button id="clearDebug" class="text-gray-400 hover:text-white text-sm">Limpar</button>
            </div>
            <div id="debugContent" class="space-y-1"></div>
        </div>

        <!-- Mensagens de Status -->
        <div id="statusMessage" class="text-center p-6 my-6 hidden rounded-xl text-lg"></div>

        <!-- Token Info Card -->
        <div id="tokenInfoCard" class="token-info-card hidden">
            <h3 class="text-xl font-semibold mb-4 flex items-center text-green-400">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                </svg>
                Informa√ß√µes do Token
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="balance-highlight">
                    <div class="text-green-400 font-semibold mb-1">Nome do Token</div>
                    <div id="tokenName" class="text-xl font-bold text-white">-</div>
                </div>
                <div class="balance-highlight">
                    <div class="text-green-400 font-semibold mb-1">S√≠mbolo</div>
                    <div id="tokenSymbol" class="text-xl font-bold text-white">-</div>
                </div>
                <div class="balance-highlight">
                    <div class="text-green-400 font-semibold mb-1">Saldo da Carteira</div>
                    <div id="tokenBalance" class="text-xl font-bold text-white">-</div>
                </div>
            </div>
        </div>

        <!-- Detailed Contract & Wallet Info -->
        <div id="detailedInfoCard" class="glass-card rounded-xl p-8 mb-8 hidden fade-in">
            <h3 class="text-2xl font-semibold mb-6 flex items-center">
                <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Informa√ß√µes Detalhadas
            </h3>
            
            <!-- Contract Information -->
            <div class="mb-8">
                <h4 class="text-xl font-semibold mb-4 text-purple-400 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                    Informa√ß√µes do Contrato
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Endere√ßo do Contrato</div>
                        <div id="contractAddress" class="text-sm font-mono text-gray-300 break-all">-</div>
                        <button id="copyContractBtn" class="mt-2 text-xs bg-purple-600 hover:bg-purple-500 px-3 py-1 rounded">
                            Copiar
                        </button>
                    </div>
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Rede Blockchain</div>
                        <div id="contractNetwork" class="text-lg font-bold text-white">-</div>
                    </div>
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Decimais do Token</div>
                        <div id="contractDecimals" class="text-lg font-bold text-white">-</div>
                    </div>
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Explorador Blockchain</div>
                        <a id="contractExplorer" href="#" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                            Ver no Explorador
                        </a>
                    </div>
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Tipo de Token</div>
                        <div class="text-lg font-bold text-white">ERC-20 / BEP-20</div>
                    </div>
                    <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4">
                        <div class="text-purple-400 font-semibold mb-2">Status da An√°lise</div>
                        <div class="text-lg font-bold text-green-400">‚úÖ Ativo</div>
                    </div>
                </div>
            </div>

            <!-- Wallet Information -->
            <div class="mb-8">
                <h4 class="text-xl font-semibold mb-4 text-blue-400 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    Informa√ß√µes da Carteira
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">Endere√ßo da Carteira</div>
                        <div id="walletAddress" class="text-sm font-mono text-gray-300 break-all">-</div>
                        <button id="copyWalletBtn" class="mt-2 text-xs bg-blue-600 hover:bg-blue-500 px-3 py-1 rounded">
                            Copiar
                        </button>
                    </div>
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">Saldo do Token</div>
                        <div id="walletTokenBalance" class="text-lg font-bold text-white">-</div>
                    </div>
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">Per√≠odo de An√°lise</div>
                        <div id="analysisPeriod" class="text-lg font-bold text-white">-</div>
                    </div>
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">Explorador da Carteira</div>
                        <a id="walletExplorer" href="#" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                            Ver Carteira
                        </a>
                    </div>
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">√öltima Atualiza√ß√£o</div>
                        <div id="lastUpdate" class="text-lg font-bold text-white">-</div>
                    </div>
                    <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4">
                        <div class="text-blue-400 font-semibold mb-2">Filtros Aplicados</div>
                        <div id="appliedFilters" class="text-sm text-gray-300">Nenhum</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div>
                <h4 class="text-xl font-semibold mb-4 text-green-400 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    A√ß√µes R√°pidas
                </h4>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button id="refreshAnalysisBtn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        Atualizar
                    </button>
                    <button id="exportDataBtn" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Exportar CSV
                    </button>
                    <button id="shareAnalysisBtn" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                        </svg>
                        Compartilhar
                    </button>
                    <button id="newAnalysisBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Nova An√°lise
                    </button>
                </div>
            </div>
        </div>

        <!-- Portfolio de Tokens -->
        <div id="portfolioCard" class="glass-card rounded-xl p-8 mb-8 hidden fade-in">
            <h3 class="text-2xl font-semibold mb-6 flex items-center">
                <svg class="w-8 h-8 text-yellow-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                Portfolio da Carteira
                <span id="portfolioValue" class="ml-auto text-xl font-bold text-green-400">$0.00</span>
            </h3>
            
            <!-- Portfolio Summary -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-xl p-4 text-center">
                    <div class="text-yellow-400 font-semibold mb-2">Total de Tokens</div>
                    <div id="totalTokens" class="text-2xl font-bold text-white">0</div>
                </div>
                <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-4 text-center">
                    <div class="text-green-400 font-semibold mb-2">Valor Total USD</div>
                    <div id="totalValueUSD" class="text-2xl font-bold text-white">$0.00</div>
                </div>
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-xl p-4 text-center">
                    <div class="text-blue-400 font-semibold mb-2">Maior Holding</div>
                    <div id="topHolding" class="text-lg font-bold text-white">-</div>
                </div>
                <div class="bg-purple-900/20 border border-purple-500/30 rounded-xl p-4 text-center">
                    <div class="text-purple-400 font-semibold mb-2">√öltima Atualiza√ß√£o</div>
                    <div id="portfolioLastUpdate" class="text-sm text-white">-</div>
                </div>
            </div>

            <!-- Tokens Table -->
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="text-left p-4 text-gray-300 font-semibold">#</th>
                            <th class="text-left p-4 text-gray-300 font-semibold">Token</th>
                            <th class="text-right p-4 text-gray-300 font-semibold">Quantidade</th>
                            <th class="text-right p-4 text-gray-300 font-semibold">Pre√ßo USD</th>
                            <th class="text-right p-4 text-gray-300 font-semibold">Valor USD</th>
                            <th class="text-right p-4 text-gray-300 font-semibold">% Portfolio</th>
                            <th class="text-center p-4 text-gray-300 font-semibold">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="portfolioTableBody" class="divide-y divide-gray-600">
                        <!-- Portfolio items will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Portfolio Actions -->
            <div class="mt-6 flex flex-wrap gap-4">
                <button id="refreshPortfolioBtn" class="bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 px-4 rounded-xl flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Atualizar Portfolio
                </button>
                <button id="exportPortfolioBtn" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-xl flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Exportar Portfolio
                </button>
                <button id="sortByValueBtn" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-xl flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path>
                    </svg>
                    Ordenar por Valor
                </button>
            </div>
        </div>

        <!-- Skeleton Loading -->
        <div id="skeletonLoading" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl p-6 animate-pulse">
                    <div class="h-5 bg-gray-600 rounded mb-3"></div>
                    <div class="h-10 bg-gray-600 rounded"></div>
                </div>
                <div class="stat-card rounded-xl p-6 animate-pulse">
                    <div class="h-5 bg-gray-600 rounded mb-3"></div>
                    <div class="h-10 bg-gray-600 rounded"></div>
                </div>
                <div class="stat-card rounded-xl p-6 animate-pulse">
                    <div class="h-5 bg-gray-600 rounded mb-3"></div>
                    <div class="h-10 bg-gray-600 rounded"></div>
                </div>
                <div class="stat-card rounded-xl p-6 animate-pulse">
                    <div class="h-5 bg-gray-600 rounded mb-3"></div>
                    <div class="h-10 bg-gray-600 rounded"></div>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div id="resultsContainer" class="hidden">
            <!-- Cards de Resumo -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl p-6 text-center fade-in">
                    <div class="flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <p class="text-lg text-gray-400">Total de Transa√ß√µes</p>
                    </div>
                    <p id="totalTx" class="text-3xl font-bold text-blue-400">0</p>
                </div>
                
                <div class="stat-card rounded-xl p-6 text-center fade-in">
                    <div class="flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-green-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                        <p class="text-lg text-gray-400">Volume Total</p>
                    </div>
                    <p id="totalVolume" class="text-3xl font-bold text-green-400">0</p>
                </div>
                
                <div class="stat-card rounded-xl p-6 text-center fade-in">
                    <div class="flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-purple-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        <p class="text-lg text-gray-400">Valor M√©dio</p>
                    </div>
                    <p id="avgValue" class="text-3xl font-bold text-purple-400">0</p>
                </div>
                
                <div class="stat-card rounded-xl p-6 text-center fade-in">
                    <div class="flex items-center justify-center mb-3">
                        <svg class="w-8 h-8 text-yellow-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-lg text-gray-400">√öltima Transa√ß√£o</p>
                    </div>
                    <p id="lastTx" class="text-lg font-bold text-yellow-400">-</p>
                </div>
            </div>

            <!-- An√°lise de Saldo -->
            <div class="glass-card rounded-xl p-8 mb-8 fade-in">
                <h3 id="flowAnalysisTitle" class="text-2xl font-semibold mb-6 flex items-center">
                    <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    An√°lise de Fluxo
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-green-900/20 border border-green-500/30 rounded-xl p-6">
                        <h4 id="incomingTitle" class="text-green-400 font-semibold mb-3 text-xl">Entradas (Recebidas)</h4>
                        <p id="incomingCount" class="text-3xl font-bold text-green-400">0</p>
                        <p id="incomingVolume" class="text-lg text-green-300 mt-2">0</p>
                    </div>
                    <div class="bg-red-900/20 border border-red-500/30 rounded-xl p-6">
                        <h4 id="outgoingTitle" class="text-red-400 font-semibold mb-3 text-xl">Sa√≠das (Enviadas)</h4>
                        <p id="outgoingCount" class="text-3xl font-bold text-red-400">0</p>
                        <p id="outgoingVolume" class="text-lg text-red-300 mt-2">0</p>
                    </div>
                </div>
                <div class="mt-6 p-6 bg-blue-900/20 border border-blue-500/30 rounded-xl">
                    <h4 id="netBalanceTitle" class="text-blue-400 font-semibold mb-3 text-xl">Saldo L√≠quido no Per√≠odo</h4>
                    <p id="netBalance" class="text-3xl font-bold">0</p>
                </div>
            </div>

            <!-- Tabela de Transa√ß√µes -->
            <div class="glass-card rounded-xl p-8 fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold flex items-center">
                        <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                        Detalhes das Transa√ß√µes
                    </h3>
                    <div class="flex items-center gap-4">
                        <button id="exportBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-3 px-6 rounded-lg flex items-center text-lg transition-all">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Exportar CSV
                        </button>
                    </div>
                </div>
                
                <div class="overflow-auto" style="max-height: 700px;">
                    <table class="min-w-full">
                        <thead class="sticky top-0 bg-gray-800/95 backdrop-blur-sm">
                            <tr>
                                <th class="text-left py-4 px-6 text-lg font-semibold text-gray-300">Hash</th>
                                <th class="text-left py-4 px-6 text-lg font-semibold text-gray-300">Data/Hora</th>
                                <th class="text-left py-4 px-6 text-lg font-semibold text-gray-300">Tipo</th>
                                <th class="text-left py-4 px-6 text-lg font-semibold text-gray-300">De</th>
                                <th class="text-left py-4 px-6 text-lg font-semibold text-gray-300">Para</th>
                                <th class="text-right py-4 px-6 text-lg font-semibold text-gray-300">Valor</th>
                                <th class="text-center py-4 px-6 text-lg font-semibold text-gray-300">Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTableBody" class="divide-y divide-gray-700/50">
                            <!-- Transa√ß√µes ser√£o inseridas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o das redes com API V2 unificada
        const CHAIN_CONFIG = {
            'eth': { chainId: 1, name: 'Ethereum', symbol: 'ETH', explorer: 'https://etherscan.io' },
            'bsc': { chainId: 56, name: 'BNB Smart Chain', symbol: 'BNB', explorer: 'https://bscscan.com' },
            'polygon': { chainId: 137, name: 'Polygon', symbol: 'MATIC', explorer: 'https://polygonscan.com' },
            'arbitrum': { chainId: 42161, name: 'Arbitrum One', symbol: 'ETH', explorer: 'https://arbiscan.io' },
            'optimism': { chainId: 10, name: 'Optimism', symbol: 'ETH', explorer: 'https://optimistic.etherscan.io' },
            'avalanche': { chainId: 43114, name: 'Avalanche C-Chain', symbol: 'AVAX', explorer: 'https://snowtrace.io' },
            'base': { chainId: 8453, name: 'Base', symbol: 'ETH', explorer: 'https://basescan.org' },
            'blast': { chainId: 81457, name: 'Blast', symbol: 'ETH', explorer: 'https://blastscan.io' },
            'scroll': { chainId: 534352, name: 'Scroll', symbol: 'ETH', explorer: 'https://scrollscan.com' },
            'zksync': { chainId: 324, name: 'zkSync Era', symbol: 'ETH', explorer: 'https://explorer.zksync.io' },
            'linea': { chainId: 59144, name: 'Linea', symbol: 'ETH', explorer: 'https://lineascan.build' },
            'mantle': { chainId: 5000, name: 'Mantle', symbol: 'MNT', explorer: 'https://explorer.mantle.xyz' }
        };

        // API Key integrada no backend (segura)
        const API_KEY = 'ECDIJNMAUY72H942SMG2A3UG53YUD275CB';
        const API_BASE_URL = 'https://api.etherscan.io/v2/api';

        // Vari√°veis globais
        let currentTransactions = [];
        let currentTokenInfo = null;
        let debugMode = true;
        let analysisMode = 'wallet'; // 'wallet' ou 'contract'
        let globalTokenAnalysis = null;

        // Elementos DOM
        const networkSelector = document.getElementById('networkSelector');
        const walletAddressInput = document.getElementById('walletAddress');
        const tokenAddressInput = document.getElementById('tokenAddress');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const statusMessage = document.getElementById('statusMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const debugPanel = document.getElementById('debugPanel');
        const debugContent = document.getElementById('debugContent');
        const tokenInfoCard = document.getElementById('tokenInfoCard');

        // Fun√ß√£o de debug
        function addDebugInfo(message, data = null, type = 'info') {
            if (!debugMode) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const debugLine = document.createElement('div');
            debugLine.className = 'debug-line';
            
            let icon = '‚ÑπÔ∏è';
            let color = 'text-blue-400';
            
            switch(type) {
                case 'success': icon = '‚úÖ'; color = 'text-green-400'; break;
                case 'error': icon = '‚ùå'; color = 'text-red-400'; break;
                case 'warning': icon = '‚ö†Ô∏è'; color = 'text-yellow-400'; break;
                case 'api': icon = 'üåê'; color = 'text-purple-400'; break;
                case 'data': icon = 'üìä'; color = 'text-cyan-400'; break;
                case 'token': icon = 'ü™ô'; color = 'text-green-400'; break;
            }
            
            debugLine.innerHTML = `
                <span class="text-gray-500">[${timestamp}]</span> 
                <span class="${color}">${icon}</span> 
                <span class="text-gray-300">${message}</span>
            `;
            
            if (data) {
                const dataDiv = document.createElement('div');
                dataDiv.className = 'ml-6 mt-1 text-xs text-gray-400 bg-gray-800/50 p-2 rounded';
                dataDiv.textContent = JSON.stringify(data, null, 2);
                debugLine.appendChild(dataDiv);
            }
            
            debugContent.appendChild(debugLine);
            debugPanel.classList.remove('hidden');
            debugPanel.scrollTop = debugPanel.scrollHeight;
        }

        // Fun√ß√£o para construir URL da API V2
        function buildApiUrl(chainKey, module, action, params = {}) {
            const chainId = CHAIN_CONFIG[chainKey].chainId;
            
            const urlParams = new URLSearchParams({
                chainid: chainId,
                module: module,
                action: action,
                apikey: API_KEY,
                ...params
            });
            
            return `${API_BASE_URL}?${urlParams.toString()}`;
        }

        // Fun√ß√£o para buscar informa√ß√µes do token espec√≠fico do contrato
        async function getTokenInfo(chainKey, tokenAddress, walletAddress) {
            try {
                addDebugInfo('ü™ô Buscando informa√ß√µes do token do contrato especificado...', { 
                    tokenAddress,
                    chainKey,
                    note: 'Analisando APENAS o token deste contrato espec√≠fico'
                }, 'token');
                
                // Primeiro, tentar buscar informa√ß√µes b√°sicas do token
                let tokenInfo = null;
                let decimals = 18;
                
                // M√©todo 1: Tentar API tokeninfo (funciona para alguns tokens)
                try {
                    const nameUrl = buildApiUrl(chainKey, 'token', 'tokeninfo', { contractaddress: tokenAddress });
                    addDebugInfo('üåê Tentando endpoint tokeninfo...', { url: nameUrl.replace(API_KEY, 'HIDDEN') }, 'api');
                    
                    const nameResponse = await fetch(nameUrl);
                    const nameData = await nameResponse.json();
                    
                    addDebugInfo('üì° Resposta tokeninfo', { 
                        status: nameData.status, 
                        message: nameData.message,
                        hasResult: !!nameData.result
                    }, 'api');
                    
                    if (nameData.status === '1' && nameData.result && nameData.result.length > 0) {
                        tokenInfo = nameData.result[0];
                        decimals = parseInt(tokenInfo.divisor) || 18;
                        addDebugInfo('‚úÖ Token info obtida via tokeninfo', tokenInfo, 'token');
                    }
                } catch (error) {
                    addDebugInfo('‚ö†Ô∏è Erro no endpoint tokeninfo', { error: error.message }, 'warning');
                }
                
                // M√©todo 2: Se n√£o funcionou, tentar buscar via transa√ß√µes de token para obter informa√ß√µes
                if (!tokenInfo) {
                    try {
                        addDebugInfo('üîÑ Tentando obter info via transa√ß√µes de token...', null, 'token');
                        
                        const txUrl = buildApiUrl(chainKey, 'account', 'tokentx', {
                            contractaddress: tokenAddress,
                            address: walletAddress,
                            page: 1,
                            offset: 1,
                            sort: 'desc'
                        });
                        
                        const txResponse = await fetch(txUrl);
                        const txData = await txResponse.json();
                        
                        addDebugInfo('üì° Resposta tokentx', { 
                            status: txData.status, 
                            message: txData.message,
                            resultCount: txData.result ? txData.result.length : 0
                        }, 'api');
                        
                        if (txData.status === '1' && txData.result && txData.result.length > 0) {
                            const firstTx = txData.result[0];
                            tokenInfo = {
                                tokenName: firstTx.tokenName || 'Token Desconhecido',
                                symbol: firstTx.tokenSymbol || 'UNKNOWN'
                            };
                            decimals = parseInt(firstTx.tokenDecimal) || 18;
                            addDebugInfo('‚úÖ Token info obtida via transa√ß√µes', tokenInfo, 'token');
                        }
                    } catch (error) {
                        addDebugInfo('‚ö†Ô∏è Erro ao buscar via transa√ß√µes', { error: error.message }, 'warning');
                    }
                }
                
                // M√©todo 3: Fallback - usar informa√ß√µes conhecidas de tokens espec√≠ficos
                if (!tokenInfo) {
                    addDebugInfo('üîÑ Verificando tokens conhecidos...', { tokenAddress }, 'token');
                    
                    // Base de dados de tokens conhecidos
                    const knownTokens = {
                        '0xAEdED60cBadD688279908dF18194FD31387baEb4': {
                            name: 'Golden Eggs',
                            symbol: 'GEGG',
                            decimals: 18
                        },
                        '0xaeded60cbadd688279908df18194fd31387baeb4': {
                            name: 'Golden Eggs',
                            symbol: 'GEGG',
                            decimals: 18
                        }
                    };
                    
                    const knownToken = knownTokens[tokenAddress.toLowerCase()];
                    if (knownToken) {
                        tokenInfo = {
                            tokenName: knownToken.name,
                            symbol: knownToken.symbol
                        };
                        decimals = knownToken.decimals;
                        
                        addDebugInfo('‚úÖ Token conhecido identificado!', {
                            name: tokenInfo.tokenName,
                            symbol: tokenInfo.symbol,
                            source: 'Base de dados de tokens conhecidos'
                        }, 'success');
                    } else {
                        addDebugInfo('üîÑ Usando informa√ß√µes padr√£o do contrato...', null, 'token');
                        tokenInfo = {
                            tokenName: 'Token Personalizado',
                            symbol: 'TOKEN'
                        };
                    }
                }
                
                // Buscar saldo do token na carteira
                let balance = '0';
                try {
                    const balanceUrl = buildApiUrl(chainKey, 'account', 'tokenbalance', { 
                        contractaddress: tokenAddress,
                        address: walletAddress
                    });
                    
                    const balanceResponse = await fetch(balanceUrl);
                    const balanceData = await balanceResponse.json();
                    
                    if (balanceData.status === '1') {
                        balance = balanceData.result;
                    }
                    
                    addDebugInfo('üí∞ Saldo obtido', { balance, decimals }, 'token');
                } catch (error) {
                    addDebugInfo('‚ö†Ô∏è Erro ao buscar saldo', { error: error.message }, 'warning');
                }
                
                const formattedBalance = (parseFloat(balance) / Math.pow(10, decimals)).toFixed(6);
                
                currentTokenInfo = {
                    name: tokenInfo.tokenName || 'Token Desconhecido',
                    symbol: tokenInfo.symbol || 'UNKNOWN',
                    balance: formattedBalance,
                    decimals: decimals,
                    contractAddress: tokenAddress
                };
                
                addDebugInfo('‚úÖ Informa√ß√µes FINAIS do token obtidas', {
                    ...currentTokenInfo,
                    note: 'Este √© o token do contrato inserido - Golden Eggs (GEGG) ou similar'
                }, 'token');
                
                displayTokenInfo();
                
            } catch (error) {
                addDebugInfo('‚ùå Erro geral ao buscar informa√ß√µes do token', { error: error.message }, 'error');
                
                // Fallback final - criar info b√°sica
                currentTokenInfo = {
                    name: 'Token do Contrato',
                    symbol: 'TOKEN',
                    balance: '0.000000',
                    decimals: 18,
                    contractAddress: tokenAddress
                };
                
                displayTokenInfo();
            }
        }

        // Fun√ß√£o para exibir informa√ß√µes do token
        function displayTokenInfo() {
            if (!currentTokenInfo) {
                addDebugInfo('‚ö†Ô∏è currentTokenInfo √© null, n√£o √© poss√≠vel exibir informa√ß√µes', null, 'warning');
                return;
            }
            
            try {
                const tokenNameEl = document.getElementById('tokenName');
                const tokenSymbolEl = document.getElementById('tokenSymbol');
                const tokenBalanceEl = document.getElementById('tokenBalance');
                
                if (tokenNameEl) tokenNameEl.textContent = currentTokenInfo.name || 'Token Desconhecido';
                if (tokenSymbolEl) tokenSymbolEl.textContent = currentTokenInfo.symbol || 'UNKNOWN';
                if (tokenBalanceEl) tokenBalanceEl.textContent = `${currentTokenInfo.balance || '0.000000'} ${currentTokenInfo.symbol || 'TOKEN'}`;
                
                if (tokenInfoCard) {
                    tokenInfoCard.classList.remove('hidden');
                }
                
                // Exibir informa√ß√µes detalhadas com seguran√ßa
                setTimeout(() => {
                    displayDetailedInfo();
                }, 100);
                
                addDebugInfo('ü™ô Card de informa√ß√µes do token exibido com seguran√ßa', {
                    name: currentTokenInfo.name,
                    symbol: currentTokenInfo.symbol,
                    balance: currentTokenInfo.balance
                }, 'token');
                
            } catch (error) {
                addDebugInfo('‚ùå Erro ao exibir informa√ß√µes do token', { 
                    error: error.message,
                    tokenInfo: currentTokenInfo 
                }, 'error');
            }
        }

        // Fun√ß√£o para exibir informa√ß√µes detalhadas do contrato e carteira
        function displayDetailedInfo() {
            try {
                const networkKey = document.getElementById('networkSelector')?.value || 'eth';
                const walletAddress = document.getElementById('walletAddress')?.value?.trim() || '';
                const tokenAddress = document.getElementById('tokenAddress')?.value?.trim() || '';
                const startDate = document.getElementById('startDate')?.value || '';
                const endDate = document.getElementById('endDate')?.value || '';
                
                // Verificar se os elementos existem antes de tentar acess√°-los
                const contractAddressEl = document.getElementById('contractAddress');
                const contractNetworkEl = document.getElementById('contractNetwork');
                const contractDecimalsEl = document.getElementById('contractDecimals');
                const contractExplorerEl = document.getElementById('contractExplorer');
                const walletExplorerEl = document.getElementById('walletExplorer');
                const walletAddressEl = document.getElementById('walletAddress');
                const walletTokenBalanceEl = document.getElementById('walletTokenBalance');
                const analysisPeriodEl = document.getElementById('analysisPeriod');
                const lastUpdateEl = document.getElementById('lastUpdate');
                const appliedFiltersEl = document.getElementById('appliedFilters');
                const detailedInfoCardEl = document.getElementById('detailedInfoCard');
                
                if (!contractAddressEl || !contractNetworkEl || !contractDecimalsEl) {
                    addDebugInfo('‚ö†Ô∏è Elementos de informa√ß√µes detalhadas n√£o encontrados', null, 'warning');
                    return;
                }
                
                // Informa√ß√µes do Contrato
                contractAddressEl.textContent = tokenAddress || 'N√£o especificado';
                contractNetworkEl.textContent = CHAIN_CONFIG[networkKey]?.name || 'Desconhecido';
                contractDecimalsEl.textContent = currentTokenInfo?.decimals?.toString() || '18';
                
                // Links para exploradores
                if (contractExplorerEl && walletExplorerEl) {
                    const explorerUrl = getExplorerUrl(networkKey, 'token', tokenAddress);
                    const walletExplorerUrl = getExplorerUrl(networkKey, 'address', walletAddress);
                    
                    contractExplorerEl.href = explorerUrl;
                    walletExplorerEl.href = walletExplorerUrl;
                }
                
                // Informa√ß√µes da Carteira
                if (walletAddressEl) {
                    walletAddressEl.textContent = walletAddress || 'N√£o especificado';
                }
                
                if (walletTokenBalanceEl) {
                    walletTokenBalanceEl.textContent = currentTokenInfo ? 
                        `${currentTokenInfo.balance || '0.000000'} ${currentTokenInfo.symbol || 'TOKEN'}` : 'N√£o dispon√≠vel';
                }
                
                // Per√≠odo de an√°lise
                if (analysisPeriodEl) {
                    if (startDate && endDate) {
                        try {
                            const start = new Date(startDate).toLocaleDateString('pt-BR');
                            const end = new Date(endDate).toLocaleDateString('pt-BR');
                            analysisPeriodEl.textContent = `${start} at√© ${end}`;
                        } catch (dateError) {
                            analysisPeriodEl.textContent = 'Per√≠odo inv√°lido';
                        }
                    } else {
                        analysisPeriodEl.textContent = 'N√£o especificado';
                    }
                }
                
                // √öltima atualiza√ß√£o
                if (lastUpdateEl) {
                    try {
                        lastUpdateEl.textContent = new Date().toLocaleString('pt-BR');
                    } catch (timeError) {
                        lastUpdateEl.textContent = 'Agora';
                    }
                }
                
                // Filtros aplicados
                if (appliedFiltersEl) {
                    const filters = [];
                    const minValue = document.getElementById('minValue')?.value;
                    const maxValue = document.getElementById('maxValue')?.value;
                    const txType = document.getElementById('txType')?.value;
                    const specificAddress = document.getElementById('specificAddress')?.value;
                    
                    if (minValue) filters.push(`Min: ${minValue}`);
                    if (maxValue) filters.push(`Max: ${maxValue}`);
                    if (txType && txType !== 'all') filters.push(`Tipo: ${txType}`);
                    if (specificAddress) filters.push(`Endere√ßo espec√≠fico`);
                    
                    appliedFiltersEl.textContent = filters.length > 0 ? filters.join(', ') : 'Nenhum';
                }
                
                // Mostrar card de informa√ß√µes detalhadas
                if (detailedInfoCardEl) {
                    detailedInfoCardEl.classList.remove('hidden');
                }
                
                addDebugInfo('üìã Informa√ß√µes detalhadas exibidas com seguran√ßa', {
                    contract: tokenAddress || 'N/A',
                    wallet: walletAddress ? walletAddress.substring(0, 10) + '...' : 'N/A',
                    network: CHAIN_CONFIG[networkKey]?.name || 'N/A',
                    hasTokenInfo: !!currentTokenInfo
                }, 'success');
                
            } catch (error) {
                addDebugInfo('‚ùå Erro ao exibir informa√ß√µes detalhadas', { 
                    error: error.message,
                    stack: error.stack 
                }, 'error');
                
                // Tentar mostrar pelo menos o card vazio
                const detailedInfoCardEl = document.getElementById('detailedInfoCard');
                if (detailedInfoCardEl) {
                    detailedInfoCardEl.classList.remove('hidden');
                }
            }
        }

        // Fun√ß√£o para obter URL do explorador
        function getExplorerUrl(networkKey, type, address) {
            const explorers = {
                'eth': 'https://etherscan.io',
                'bsc': 'https://bscscan.com',
                'polygon': 'https://polygonscan.com',
                'arbitrum': 'https://arbiscan.io',
                'optimism': 'https://optimistic.etherscan.io',
                'avalanche': 'https://snowtrace.io',
                'base': 'https://basescan.org',
                'blast': 'https://blastscan.io',
                'scroll': 'https://scrollscan.com',
                'zksync': 'https://explorer.zksync.io'
            };
            
            const baseUrl = explorers[networkKey] || 'https://etherscan.io';
            const path = type === 'token' ? 'token' : 'address';
            
            return `${baseUrl}/${path}/${address}`;
        }

        // Configura√ß√£o inicial das datas
        function initializeDates() {
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);

            endDateInput.value = today.toISOString().split('T')[0];
            startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
        }

        // Fun√ß√£o para definir per√≠odos r√°pidos
        window.setPeriod = (days) => {
            const today = new Date();
            const pastDate = new Date();
            pastDate.setDate(today.getDate() - days);

            endDateInput.value = today.toISOString().split('T')[0];
            startDateInput.value = pastDate.toISOString().split('T')[0];
            
            addDebugInfo(`Per√≠odo definido para ${days} dias`, { startDate: pastDate.toISOString(), endDate: today.toISOString() });
        };

        // Toggle de filtros avan√ßados
        document.getElementById('toggleFilters').addEventListener('click', function() {
            const filters = document.getElementById('advancedFilters');
            filters.classList.toggle('hidden');
            addDebugInfo('Filtros avan√ßados ' + (filters.classList.contains('hidden') ? 'ocultados' : 'exibidos'));
        });

        // Clear debug
        document.getElementById('clearDebug').addEventListener('click', function() {
            debugContent.innerHTML = '';
            addDebugInfo('Debug limpo', null, 'info');
        });

        // Fun√ß√£o para exibir mensagens de status
        function showStatus(message, isError = false, isWarning = false) {
            statusMessage.textContent = message;
            let className = 'p-6 my-6 rounded-xl text-center text-lg ';
            
            if (isError) {
                className += 'bg-red-900/50 text-red-200 border border-red-500/30';
                addDebugInfo('ERRO: ' + message, null, 'error');
            } else if (isWarning) {
                className += 'bg-yellow-900/50 text-yellow-200 border border-yellow-500/30';
                addDebugInfo('AVISO: ' + message, null, 'warning');
            } else {
                className += 'bg-blue-900/50 text-blue-200 border border-blue-500/30';
                addDebugInfo('INFO: ' + message, null, 'success');
            }
            
            statusMessage.className = className;
            statusMessage.classList.remove('hidden');
        }

        // Fun√ß√£o para ocultar status
        function hideStatus() {
            statusMessage.classList.add('hidden');
        }

        // Fun√ß√£o para mostrar/ocultar loading
        function toggleLoading(show) {
            const searchIcon = document.getElementById('search-icon');
            const loadingSpinner = document.getElementById('loading-spinner');
            const skeletonLoading = document.getElementById('skeletonLoading');
            
            if (show) {
                searchIcon.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
                skeletonLoading.classList.remove('hidden');
                analyzeBtn.disabled = true;
                analyzeBtn.classList.add('pulse-animation');
                addDebugInfo('Iniciando an√°lise com Wallex...', null, 'api');
            } else {
                searchIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                skeletonLoading.classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('pulse-animation');
                addDebugInfo('An√°lise finalizada', null, 'success');
            }
        }

        // Validar endere√ßo
        function isValidAddress(address) {
            return /^0x[a-fA-F0-9]{40}$/.test(address);
        }

        // Fun√ß√£o principal de an√°lise
        async function analyzeTransactions() {
            const walletAddress = walletAddressInput.value.trim();
            const networkKey = networkSelector.value;
            const tokenAddress = tokenAddressInput.value.trim();
            
            addDebugInfo('üöÄ Iniciando an√°lise com Wallex', {
                network: CHAIN_CONFIG[networkKey].name,
                chainId: CHAIN_CONFIG[networkKey].chainId,
                walletAddress: walletAddress.substring(0, 10) + '...',
                hasTokenAddress: !!tokenAddress,
                apiKeyIntegrated: true
            }, 'api');

            // Valida√ß√µes
            if (!walletAddress) {
                showStatus('Por favor, insira um endere√ßo de carteira.', true);
                return;
            }
            
            if (!isValidAddress(walletAddress)) {
                showStatus('Endere√ßo de carteira inv√°lido. Deve ter 42 caracteres e come√ßar com 0x.', true);
                return;
            }

            if (tokenAddress && !isValidAddress(tokenAddress)) {
                showStatus('Endere√ßo de token inv√°lido. Deve ter 42 caracteres e come√ßar com 0x.', true);
                return;
            }

            hideStatus();
            toggleLoading(true);
            
            // Ocultar card de token anterior
            tokenInfoCard.classList.add('hidden');
            currentTokenInfo = null;
            
            try {
                // Buscar portfolio da carteira primeiro - SEMPRE
                addDebugInfo('üíº Carregando portfolio da carteira...', null, 'info');
                
                // For√ßar exibi√ß√£o do portfolio card
                const portfolioCard = document.getElementById('portfolioCard');
                if (portfolioCard) {
                    portfolioCard.classList.remove('hidden');
                    addDebugInfo('üìã Portfolio card exibido', null, 'info');
                }
                
                await fetchWalletPortfolio();

                // Se h√° endere√ßo de token, buscar suas informa√ß√µes primeiro
                // IMPORTANTE: Analisa APENAS o token do contrato especificado, n√£o tokens de swap
                if (tokenAddress) {
                    await getTokenInfo(networkKey, tokenAddress, walletAddress);
                    addDebugInfo('üéØ Foco da an√°lise', {
                        message: 'Analisando APENAS transa√ß√µes do token especificado',
                        tokenContract: tokenAddress,
                        note: 'N√£o inclui outros tokens usados em swaps'
                    }, 'token');
                }
                
                // Construir URL da API V2
                let url;
                if (tokenAddress) {
                    url = buildApiUrl(networkKey, 'account', 'tokentx', {
                        contractaddress: tokenAddress,
                        address: walletAddress,
                        startblock: 0,
                        endblock: 99999999,
                        page: 1,
                        offset: 1000,
                        sort: 'desc'
                    });
                } else {
                    url = buildApiUrl(networkKey, 'account', 'txlist', {
                        address: walletAddress,
                        startblock: 0,
                        endblock: 99999999,
                        page: 1,
                        offset: 1000,
                        sort: 'desc'
                    });
                }

                addDebugInfo('üåê Fazendo requisi√ß√£o para API V2', { 
                    url: url.replace(API_KEY, 'HIDDEN'),
                    chainId: CHAIN_CONFIG[networkKey].chainId,
                    network: CHAIN_CONFIG[networkKey].name
                }, 'api');

                const response = await fetch(url);
                
                addDebugInfo('üì° Resposta recebida da API V2', { 
                    status: response.status, 
                    statusText: response.statusText,
                    ok: response.ok
                }, 'api');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                
                addDebugInfo('üìä Dados processados da API V2', { 
                    status: data.status, 
                    message: data.message,
                    resultCount: data.result ? data.result.length : 0
                }, 'data');

                if (data.status === '1' && data.result) {
                    currentTransactions = data.result;
                    
                    // Filtrar por per√≠odo se especificado
                    if (startDateInput.value && endDateInput.value) {
                        const startDate = new Date(startDateInput.value);
                        const endDate = new Date(endDateInput.value);
                        endDate.setHours(23, 59, 59, 999);

                        const originalCount = currentTransactions.length;
                        currentTransactions = currentTransactions.filter(tx => {
                            const txDate = new Date(tx.timeStamp * 1000);
                            return txDate >= startDate && txDate <= endDate;
                        });

                        addDebugInfo('üìÖ Filtro de data aplicado', { 
                            originalCount, 
                            filteredCount: currentTransactions.length,
                            startDate: startDate.toISOString(),
                            endDate: endDate.toISOString()
                        }, 'data');
                    }

                    if (currentTransactions.length === 0) {
                        showStatus('Nenhuma transa√ß√£o encontrada para o per√≠odo selecionado.', false);
                        return;
                    }

                    processTransactions();
                    showResults();
                    
                    const tokenText = tokenAddress ? ` do token ${currentTokenInfo?.symbol || 'especificado'}` : '';
                    showStatus(`‚úÖ An√°lise conclu√≠da com Wallex! Encontradas ${currentTransactions.length} transa√ß√µes${tokenText} na rede ${CHAIN_CONFIG[networkKey].name}.`);
                } else {
                    throw new Error(data.message || 'Erro ao buscar transa√ß√µes');
                }
            } catch (error) {
                addDebugInfo('üí• Erro durante an√°lise', { 
                    error: error.message,
                    stack: error.stack
                }, 'error');
                console.error('Erro:', error);
                showStatus(`Erro ao analisar transa√ß√µes: ${error.message}`, true);
            } finally {
                toggleLoading(false);
            }
        }

        // Fun√ß√£o para processar transa√ß√µes
        function processTransactions() {
            const walletAddress = walletAddressInput.value.trim().toLowerCase();
            const networkKey = networkSelector.value;
            const symbol = currentTokenInfo?.symbol || CHAIN_CONFIG[networkKey].symbol;
            const tokenName = currentTokenInfo?.name || CHAIN_CONFIG[networkKey].name;
            
            addDebugInfo('üîÑ Processando transa√ß√µes', { 
                count: currentTransactions.length,
                network: CHAIN_CONFIG[networkKey].name,
                symbol: symbol,
                hasTokenInfo: !!currentTokenInfo
            }, 'data');
            
            let totalVolume = 0;
            let incomingCount = 0;
            let outgoingCount = 0;
            let incomingVolume = 0;
            let outgoingVolume = 0;

            currentTransactions.forEach(tx => {
                const decimals = currentTokenInfo?.decimals || (tx.tokenDecimal ? parseInt(tx.tokenDecimal) : 18);
                const value = parseFloat(tx.value) / Math.pow(10, decimals);
                totalVolume += value;
                
                if (tx.to.toLowerCase() === walletAddress) {
                    incomingCount++;
                    incomingVolume += value;
                } else {
                    outgoingCount++;
                    outgoingVolume += value;
                }
            });

            const avgValue = totalVolume / currentTransactions.length || 0;
            const netBalance = incomingVolume - outgoingVolume;
            const lastTx = currentTransactions[0];
            const lastTxTime = new Date(parseInt(lastTx.timeStamp) * 1000);
            const timeAgo = getTimeAgo(lastTxTime);

            addDebugInfo('üìà Estat√≠sticas calculadas', {
                totalVolume,
                incomingCount,
                outgoingCount,
                incomingVolume,
                outgoingVolume,
                avgValue,
                netBalance
            }, 'data');

            // Atualizar cards de resumo
            document.getElementById('totalTx').textContent = currentTransactions.length;
            document.getElementById('totalVolume').textContent = currentTokenInfo ? 
                `${totalVolume.toFixed(6)} ${tokenName} (${symbol})` : 
                `${totalVolume.toFixed(6)} ${symbol}`;
            document.getElementById('avgValue').textContent = currentTokenInfo ? 
                `${avgValue.toFixed(6)} ${tokenName} (${symbol})` : 
                `${avgValue.toFixed(6)} ${symbol}`;
            document.getElementById('lastTx').textContent = timeAgo;

            // Atualizar t√≠tulos da an√°lise de fluxo - SEMPRE mostra o token do contrato especificado
            if (currentTokenInfo) {
                const contractShort = currentTokenInfo.contractAddress ? 
                    `${currentTokenInfo.contractAddress.substring(0, 6)}...${currentTokenInfo.contractAddress.substring(currentTokenInfo.contractAddress.length - 4)}` : '';
                
                document.getElementById('flowAnalysisTitle').innerHTML = `
                    <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    An√°lise de Fluxo - ${tokenName} (${symbol})
                    <span class="text-sm text-gray-400 ml-2">Contrato: ${contractShort}</span>
                `;
                document.getElementById('incomingTitle').textContent = `${tokenName} (${symbol}) - Entradas Recebidas`;
                document.getElementById('outgoingTitle').textContent = `${tokenName} (${symbol}) - Sa√≠das Enviadas`;
                document.getElementById('netBalanceTitle').textContent = `${tokenName} (${symbol}) - Saldo L√≠quido no Per√≠odo`;
            } else {
                document.getElementById('flowAnalysisTitle').innerHTML = `
                    <svg class="w-8 h-8 text-blue-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    An√°lise de Fluxo - ${CHAIN_CONFIG[networkKey].name} (${symbol})
                `;
                document.getElementById('incomingTitle').textContent = `${symbol} - Entradas Recebidas`;
                document.getElementById('outgoingTitle').textContent = `${symbol} - Sa√≠das Enviadas`;
                document.getElementById('netBalanceTitle').textContent = `${symbol} - Saldo L√≠quido no Per√≠odo`;
            }

            // Atualizar an√°lise de fluxo
            document.getElementById('incomingCount').textContent = incomingCount;
            document.getElementById('incomingVolume').textContent = currentTokenInfo ? 
                `${incomingVolume.toFixed(6)} ${tokenName} (${symbol})` : 
                `${incomingVolume.toFixed(6)} ${symbol}`;
            document.getElementById('outgoingCount').textContent = outgoingCount;
            document.getElementById('outgoingVolume').textContent = currentTokenInfo ? 
                `${outgoingVolume.toFixed(6)} ${tokenName} (${symbol})` : 
                `${outgoingVolume.toFixed(6)} ${symbol}`;
            
            const netBalanceElement = document.getElementById('netBalance');
            netBalanceElement.textContent = currentTokenInfo ? 
                `${netBalance >= 0 ? '+' : ''}${netBalance.toFixed(6)} ${tokenName} (${symbol})` : 
                `${netBalance >= 0 ? '+' : ''}${netBalance.toFixed(6)} ${symbol}`;
            netBalanceElement.className = `text-3xl font-bold ${netBalance >= 0 ? 'text-green-400' : 'text-red-400'}`;

            // Renderizar tabela
            renderTransactionTable();
        }

        // Fun√ß√£o para renderizar tabela de transa√ß√µes
        function renderTransactionTable() {
            const tbody = document.getElementById('transactionTableBody');
            const walletAddress = walletAddressInput.value.trim().toLowerCase();
            const networkKey = networkSelector.value;
            const symbol = currentTokenInfo?.symbol || CHAIN_CONFIG[networkKey].symbol;
            const tokenName = currentTokenInfo?.name || CHAIN_CONFIG[networkKey].name;
            const displaySymbol = currentTokenInfo ? `${tokenName} (${symbol})` : symbol;
            const explorer = CHAIN_CONFIG[networkKey].explorer;
            
            tbody.innerHTML = '';

            addDebugInfo('üèóÔ∏è Renderizando tabela de transa√ß√µes', { 
                count: Math.min(currentTransactions.length, 50),
                network: CHAIN_CONFIG[networkKey].name,
                explorer: explorer,
                displaySymbol: displaySymbol,
                hasTokenInfo: !!currentTokenInfo
            }, 'data');

            currentTransactions.slice(0, 50).forEach(tx => {
                const decimals = currentTokenInfo?.decimals || (tx.tokenDecimal ? parseInt(tx.tokenDecimal) : 18);
                const value = parseFloat(tx.value) / Math.pow(10, decimals);
                const isIncoming = tx.to.toLowerCase() === walletAddress;
                const date = new Date(parseInt(tx.timeStamp) * 1000);
                const timeAgo = getTimeAgo(date);

                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700/30 transition-colors';
                row.innerHTML = `
                    <td class="p-4 text-sm">
                        <a href="${explorer}/tx/${tx.hash}" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors font-mono">
                            ${tx.hash.substring(0, 10)}...${tx.hash.substring(tx.hash.length - 8)}
                        </a>
                    </td>
                    <td class="p-4 text-sm text-gray-300">
                        <div>${date.toLocaleString('pt-BR')}</div>
                        <div class="text-xs text-gray-500">${timeAgo}</div>
                    </td>
                    <td class="p-4 text-sm">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${isIncoming ? 'bg-green-900/30 text-green-300' : 'bg-red-900/30 text-red-300'}">
                            ${isIncoming ? '‚Üô Recebida' : '‚Üó Enviada'}
                        </span>
                    </td>
                    <td class="p-4 text-sm">
                        <a href="${explorer}/address/${tx.from}" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors font-mono">
                            ${tx.from.substring(0, 6)}...${tx.from.substring(tx.from.length - 4)}
                        </a>
                    </td>
                    <td class="p-4 text-sm">
                        <a href="${explorer}/address/${tx.to}" target="_blank" class="text-blue-400 hover:text-blue-300 transition-colors font-mono">
                            ${tx.to.substring(0, 6)}...${tx.to.substring(tx.to.length - 4)}
                        </a>
                    </td>
                    <td class="p-4 text-sm font-mono text-right ${isIncoming ? 'text-green-400' : 'text-red-400'} font-semibold">
                        ${isIncoming ? '+' : '-'} ${value.toFixed(6)} ${displaySymbol}
                    </td>
                    <td class="p-4 text-center">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-900/30 text-green-300">
                            ‚úì Confirmada
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fun√ß√£o para calcular tempo relativo
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Agora mesmo';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} min atr√°s`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} h atr√°s`;
            if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} dias atr√°s`;
            return `${Math.floor(diffInSeconds / 2592000)} meses atr√°s`;
        }

        // Fun√ß√£o para mostrar resultados
        function showResults() {
            resultsContainer.classList.remove('hidden');
            addDebugInfo('‚úÖ Resultados exibidos com sucesso', null, 'success');
        }

        // Fun√ß√£o para exportar CSV
        function exportToCSV() {
            if (!currentTransactions.length) {
                showStatus('Nenhuma transa√ß√£o para exportar.', true);
                return;
            }

            const networkKey = networkSelector.value;
            const symbol = currentTokenInfo?.symbol || CHAIN_CONFIG[networkKey].symbol;
            const tokenName = currentTokenInfo?.name || CHAIN_CONFIG[networkKey].name;
            const displaySymbol = currentTokenInfo ? `${tokenName} (${symbol})` : symbol;
            
            const headers = ['Hash', 'Data/Hora', 'Tipo', 'De', 'Para', 'Valor', 'Status'];
            const csvContent = [
                headers.join(','),
                ...currentTransactions.map(tx => {
                    const decimals = currentTokenInfo?.decimals || (tx.tokenDecimal ? parseInt(tx.tokenDecimal) : 18);
                    const value = parseFloat(tx.value) / Math.pow(10, decimals);
                    const walletAddress = walletAddressInput.value.trim().toLowerCase();
                    const isIncoming = tx.to.toLowerCase() === walletAddress;
                    const date = new Date(parseInt(tx.timeStamp) * 1000);
                    
                    return [
                        tx.hash,
                        date.toLocaleString('pt-BR'),
                        isIncoming ? 'Recebida' : 'Enviada',
                        tx.from,
                        tx.to,
                        `${value.toFixed(6)} ${displaySymbol}`,
                        'Confirmada'
                    ].join(',');
                })
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `wallex_${networkKey}_${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            addDebugInfo('üíæ CSV exportado com sucesso', { 
                filename: `wallex_${networkKey}_${Date.now()}.csv`,
                records: currentTransactions.length
            }, 'success');
        }

        // Vari√°veis globais para portfolio
        let currentPortfolio = [];
        let portfolioTotalValue = 0;

        // Fun√ß√£o para buscar portfolio da carteira
        async function fetchWalletPortfolio() {
            const walletAddress = document.getElementById('walletAddress').value.trim();
            const networkKey = document.getElementById('networkSelector').value;
            
            if (!walletAddress) {
                addDebugInfo('‚ùå Endere√ßo da carteira √© obrigat√≥rio para portfolio', null, 'error');
                return;
            }

            addDebugInfo('üíº Iniciando an√°lise de portfolio...', { wallet: walletAddress.substring(0, 10) + '...' }, 'info');
            
            // Limpar portfolio anterior
            currentPortfolio = [];
            portfolioTotalValue = 0;
            
            try {
                // Mostrar card de portfolio
                const portfolioCard = document.getElementById('portfolioCard');
                if (portfolioCard) {
                    portfolioCard.classList.remove('hidden');
                }
                
                // Buscar saldo nativo da rede SEMPRE
                addDebugInfo('üîç Buscando saldo nativo...', null, 'info');
                await fetchNativeBalance(walletAddress, networkKey);
                
                // Buscar todos os tokens ERC-20/BEP-20
                addDebugInfo('üîç Buscando tokens da carteira...', null, 'info');
                await fetchTokenBalances(walletAddress, networkKey);
                
                // Buscar pre√ßos em USD
                addDebugInfo('üí≤ Atualizando pre√ßos USD...', null, 'info');
                await fetchTokenPrices();
                
                // Calcular e exibir portfolio SEMPRE (mesmo se vazio)
                calculatePortfolioValue();
                displayPortfolio();
                
                addDebugInfo('‚úÖ Portfolio carregado com sucesso', { 
                    tokens: currentPortfolio.length,
                    totalValue: `$${portfolioTotalValue.toFixed(2)}`
                }, 'success');
                
            } catch (error) {
                addDebugInfo('‚ùå Erro ao carregar portfolio', { error: error.message }, 'error');
                // Mesmo com erro, mostrar o que conseguiu carregar
                calculatePortfolioValue();
                displayPortfolio();
            }
        }

        // Fun√ß√£o para buscar saldo nativo (ETH, BNB, MATIC, etc.)
        async function fetchNativeBalance(walletAddress, networkKey) {
            const chainId = CHAIN_CONFIG[networkKey].chainId;
            const url = `https://api.etherscan.io/v2/api?module=account&action=balance&address=${walletAddress}&tag=latest&apikey=${API_KEY}&chainid=${chainId}`;
            
            addDebugInfo('üåê Consultando API para saldo nativo', { 
                network: CHAIN_CONFIG[networkKey].name,
                chainId: chainId 
            }, 'info');
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                addDebugInfo('üì° Resposta da API recebida', { 
                    status: data.status,
                    hasResult: !!data.result 
                }, 'info');
                
                if (data.status === '1' && data.result) {
                    const balance = parseFloat(data.result) / Math.pow(10, 18);
                    
                    // Adicionar ao portfolio SEMPRE, mesmo se saldo for 0
                    currentPortfolio.push({
                        name: CHAIN_CONFIG[networkKey].name,
                        symbol: CHAIN_CONFIG[networkKey].symbol,
                        balance: balance,
                        contractAddress: 'native',
                        decimals: 18,
                        priceUSD: 0, // Ser√° preenchido depois
                        valueUSD: 0,
                        isNative: true
                    });
                    
                    addDebugInfo('üí∞ Saldo nativo adicionado', { 
                        symbol: CHAIN_CONFIG[networkKey].symbol,
                        balance: balance.toFixed(6)
                    }, 'token');
                } else {
                    addDebugInfo('‚ö†Ô∏è API retornou erro ou sem resultado', { 
                        status: data.status,
                        message: data.message || 'Sem dados'
                    }, 'warning');
                    
                    // Adicionar com saldo 0 para mostrar a rede
                    currentPortfolio.push({
                        name: CHAIN_CONFIG[networkKey].name,
                        symbol: CHAIN_CONFIG[networkKey].symbol,
                        balance: 0,
                        contractAddress: 'native',
                        decimals: 18,
                        priceUSD: 0,
                        valueUSD: 0,
                        isNative: true
                    });
                }
            } catch (error) {
                addDebugInfo('‚ùå Erro na requisi√ß√£o de saldo nativo', { error: error.message }, 'error');
                
                // Adicionar com saldo 0 mesmo com erro
                currentPortfolio.push({
                    name: CHAIN_CONFIG[networkKey].name,
                    symbol: CHAIN_CONFIG[networkKey].symbol,
                    balance: 0,
                    contractAddress: 'native',
                    decimals: 18,
                    priceUSD: 0,
                    valueUSD: 0,
                    isNative: true
                });
            }
        }

        // Fun√ß√£o para buscar saldos de tokens
        async function fetchTokenBalances(walletAddress, networkKey) {
            const chainId = CHAIN_CONFIG[networkKey].chainId;
            const url = `https://api.etherscan.io/v2/api?module=account&action=tokentx&address=${walletAddress}&startblock=0&endblock=99999999&sort=desc&apikey=${API_KEY}&chainid=${chainId}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === '1' && data.result && Array.isArray(data.result)) {
                    // Agrupar por contrato de token
                    const tokenContracts = {};
                    
                    data.result.forEach(tx => {
                        const contract = tx.contractAddress.toLowerCase();
                        if (!tokenContracts[contract]) {
                            tokenContracts[contract] = {
                                name: tx.tokenName,
                                symbol: tx.tokenSymbol,
                                decimals: parseInt(tx.tokenDecimal),
                                contractAddress: tx.contractAddress,
                                transactions: []
                            };
                        }
                        tokenContracts[contract].transactions.push(tx);
                    });
                    
                    // Calcular saldo de cada token
                    for (const [contract, tokenData] of Object.entries(tokenContracts)) {
                        const balance = await calculateTokenBalance(walletAddress, tokenData.transactions, tokenData.decimals);
                        
                        if (balance > 0) {
                            currentPortfolio.push({
                                name: tokenData.name,
                                symbol: tokenData.symbol,
                                balance: balance,
                                contractAddress: tokenData.contractAddress,
                                decimals: tokenData.decimals,
                                priceUSD: 0,
                                valueUSD: 0,
                                isNative: false
                            });
                            
                            addDebugInfo('ü™ô Token encontrado', { 
                                symbol: tokenData.symbol,
                                balance: balance.toFixed(6)
                            }, 'token');
                        }
                    }
                }
            } catch (error) {
                addDebugInfo('‚ö†Ô∏è Erro ao buscar tokens', { error: error.message }, 'warning');
            }
        }

        // Fun√ß√£o para calcular saldo de um token espec√≠fico
        async function calculateTokenBalance(walletAddress, transactions, decimals) {
            let balance = 0;
            const wallet = walletAddress.toLowerCase();
            
            transactions.forEach(tx => {
                const value = parseFloat(tx.value) / Math.pow(10, decimals);
                
                if (tx.to.toLowerCase() === wallet) {
                    balance += value; // Recebido
                } else if (tx.from.toLowerCase() === wallet) {
                    balance -= value; // Enviado
                }
            });
            
            return Math.max(0, balance); // N√£o pode ser negativo
        }

        // Fun√ß√£o para buscar pre√ßos em USD (simulado - em produ√ß√£o usar API de pre√ßos)
        async function fetchTokenPrices() {
            // Pre√ßos atualizados para demonstra√ß√£o (baseados em pre√ßos reais)
            const mockPrices = {
                'ETH': 2650,
                'BNB': 315,
                'MATIC': 0.85,
                'AVAX': 28,
                'ARB': 0.95,
                'OP': 1.85,
                'BASE': 1.2,
                'BLAST': 0.02,
                'SCROLL': 0.75,
                'ZK': 0.15,
                'LINEA': 0.45,
                'MNT': 0.65,
                'USDT': 1.00,
                'USDC': 1.00,
                'BUSD': 1.00,
                'DAI': 1.00,
                'GEGG': 0.0015,
                'PEPE': 0.00000125,
                'SHIB': 0.000025,
                'DOGE': 0.12,
                'LINK': 15.50,
                'UNI': 8.75,
                'AAVE': 185,
                'COMP': 65,
                'SUSHI': 1.25,
                'CRV': 0.85,
                'YFI': 8500,
                'SNX': 2.85,
                'MKR': 1850,
                'WBTC': 67500,
                'WETH': 2650
            };
            
            let pricesFound = 0;
            
            currentPortfolio.forEach(token => {
                const price = mockPrices[token.symbol] || mockPrices[token.symbol.toUpperCase()] || 0;
                token.priceUSD = price;
                token.valueUSD = token.balance * token.priceUSD;
                
                if (price > 0) {
                    pricesFound++;
                    addDebugInfo(`üí∞ Pre√ßo encontrado: ${token.symbol}`, { 
                        price: `$${price}`,
                        balance: token.balance.toFixed(6),
                        value: `$${token.valueUSD.toFixed(2)}`
                    }, 'token');
                }
            });
            
            addDebugInfo('üí≤ Pre√ßos atualizados', { 
                tokens: currentPortfolio.length,
                pricesFound: pricesFound,
                totalValue: `$${currentPortfolio.reduce((sum, t) => sum + t.valueUSD, 0).toFixed(2)}`
            }, 'success');
        }

        // Fun√ß√£o para calcular valor total do portfolio
        function calculatePortfolioValue() {
            portfolioTotalValue = currentPortfolio.reduce((total, token) => total + token.valueUSD, 0);
            
            // Ordenar por valor USD (maior primeiro)
            currentPortfolio.sort((a, b) => b.valueUSD - a.valueUSD);
        }

        // Fun√ß√£o para exibir portfolio na interface
        function displayPortfolio() {
            // Atualizar resumo
            document.getElementById('totalTokens').textContent = currentPortfolio.length;
            document.getElementById('totalValueUSD').textContent = `$${portfolioTotalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('portfolioValue').textContent = `$${portfolioTotalValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('portfolioLastUpdate').textContent = new Date().toLocaleString('pt-BR');
            
            // Maior holding
            if (currentPortfolio.length > 0) {
                const topToken = currentPortfolio[0];
                document.getElementById('topHolding').textContent = `${topToken.symbol} ($${topToken.valueUSD.toFixed(2)})`;
            }
            
            // Preencher tabela
            const tbody = document.getElementById('portfolioTableBody');
            tbody.innerHTML = '';
            
            currentPortfolio.forEach((token, index) => {
                const percentage = portfolioTotalValue > 0 ? (token.valueUSD / portfolioTotalValue * 100) : 0;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700/50 transition-colors';
                row.innerHTML = `
                    <td class="p-4 text-gray-400">${index + 1}</td>
                    <td class="p-4">
                        <div class="flex items-center">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold text-sm mr-3">
                                ${token.symbol.substring(0, 2)}
                            </div>
                            <div>
                                <div class="font-semibold text-white">${token.name}</div>
                                <div class="text-sm text-gray-400">${token.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="p-4 text-right font-mono text-white">${token.balance.toLocaleString('en-US', { minimumFractionDigits: 6, maximumFractionDigits: 6 })}</td>
                    <td class="p-4 text-right font-mono text-green-400">$${token.priceUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 6 })}</td>
                    <td class="p-4 text-right font-mono font-bold text-white">$${token.valueUSD.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td class="p-4 text-right">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-sm font-medium bg-blue-900/30 text-blue-300">
                            ${percentage.toFixed(2)}%
                        </span>
                    </td>
                    <td class="p-4 text-center">
                        <button onclick="analyzeToken('${token.contractAddress}')" class="text-blue-400 hover:text-blue-300 text-sm underline">
                            Analisar
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fun√ß√£o para analisar token espec√≠fico
        function analyzeToken(contractAddress) {
            if (contractAddress === 'native') {
                // Limpar campo de token para analisar moeda nativa
                document.getElementById('tokenAddress').value = '';
            } else {
                // Preencher campo de token
                document.getElementById('tokenAddress').value = contractAddress;
            }
            
            // Executar an√°lise
            analyzeTransactions();
        }

        // Fun√ß√£o para exportar portfolio
        function exportPortfolio() {
            const headers = ['#', 'Token', 'S√≠mbolo', 'Quantidade', 'Pre√ßo USD', 'Valor USD', '% Portfolio'];
            const csvContent = [
                headers.join(','),
                ...currentPortfolio.map((token, index) => {
                    const percentage = portfolioTotalValue > 0 ? (token.valueUSD / portfolioTotalValue * 100) : 0;
                    return [
                        index + 1,
                        token.name,
                        token.symbol,
                        token.balance.toFixed(6),
                        token.priceUSD.toFixed(6),
                        token.valueUSD.toFixed(2),
                        percentage.toFixed(2) + '%'
                    ].join(',');
                }),
                '',
                `Total Portfolio Value,$${portfolioTotalValue.toFixed(2)}`,
                `Total Tokens,${currentPortfolio.length}`,
                `Generated,${new Date().toLocaleString('pt-BR')}`
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `wallex-portfolio-${Date.now()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addDebugInfo('üìä Portfolio exportado', { records: currentPortfolio.length }, 'success');
        }

        // Fun√ß√£o para alternar modo de an√°lise
        function switchAnalysisMode(mode) {
            analysisMode = mode;
            
            // Atualizar cards visuais
            const walletCard = document.getElementById('walletModeCard');
            const contractCard = document.getElementById('contractModeCard');
            
            if (mode === 'wallet') {
                walletCard.classList.add('active');
                contractCard.classList.remove('active');
                
                // Mostrar configura√ß√£o de carteira
                document.getElementById('walletAnalysisConfig').classList.remove('hidden');
                document.getElementById('contractAnalysisConfig').classList.add('hidden');
                
                // Atualizar t√≠tulo e bot√£o
                document.getElementById('configTitle').textContent = 'Configura√ß√£o da An√°lise de Carteira';
                document.getElementById('analyzeBtnText').textContent = 'Analisar Carteira';
                
                addDebugInfo('üîÑ Modo alterado para An√°lise de Carteira', null, 'info');
            } else {
                contractCard.classList.add('active');
                walletCard.classList.remove('active');
                
                // Mostrar configura√ß√£o de contrato
                document.getElementById('contractAnalysisConfig').classList.remove('hidden');
                document.getElementById('walletAnalysisConfig').classList.add('hidden');
                
                // Atualizar t√≠tulo e bot√£o
                document.getElementById('configTitle').textContent = 'Configura√ß√£o da An√°lise Global de Token';
                document.getElementById('analyzeBtnText').textContent = 'Analisar Token Globalmente';
                
                addDebugInfo('üîÑ Modo alterado para An√°lise Global de Token', null, 'info');
            }
        }

        // Fun√ß√£o para an√°lise global de token
        async function analyzeGlobalToken() {
            const contractAddress = document.getElementById('contractAddressInput').value.trim();
            const networkKey = document.getElementById('contractNetworkSelector').value;
            
            addDebugInfo('üåç Iniciando an√°lise global de token', {
                contract: contractAddress.substring(0, 10) + '...',
                network: CHAIN_CONFIG[networkKey].name,
                chainId: CHAIN_CONFIG[networkKey].chainId
            }, 'api');

            // Valida√ß√µes
            if (!contractAddress) {
                showStatus('Por favor, insira o endere√ßo do contrato do token.', true);
                return;
            }
            
            if (!isValidAddress(contractAddress)) {
                showStatus('Endere√ßo de contrato inv√°lido. Deve ter 42 caracteres e come√ßar com 0x.', true);
                return;
            }

            hideStatus();
            toggleLoading(true);
            
            try {
                // Buscar informa√ß√µes do token primeiro
                addDebugInfo('üîç Obtendo informa√ß√µes do token...', null, 'info');
                await getGlobalTokenInfo(networkKey, contractAddress);
                
                // Buscar TODAS as transa√ß√µes do token (sem filtro de carteira)
                addDebugInfo('üìä Buscando todas as transa√ß√µes do token...', null, 'info');
                const allTransactions = await fetchAllTokenTransactions(networkKey, contractAddress);
                
                if (allTransactions.length === 0) {
                    showStatus('Nenhuma transa√ß√£o encontrada para este token.', false);
                    return;
                }
                
                // Processar an√°lise global
                addDebugInfo('‚ö° Processando an√°lise global...', { totalTx: allTransactions.length }, 'data');
                const globalAnalysis = processGlobalTokenAnalysis(allTransactions, contractAddress);
                
                // Exibir resultados
                displayGlobalTokenResults(globalAnalysis);
                showResults();
                
                showStatus(`‚úÖ An√°lise global conclu√≠da! Processadas ${allTransactions.length} transa√ß√µes do token ${currentTokenInfo?.symbol || 'desconhecido'}.`);
                
            } catch (error) {
                addDebugInfo('üí• Erro durante an√°lise global', { 
                    error: error.message,
                    stack: error.stack
                }, 'error');
                console.error('Erro:', error);
                showStatus(`Erro ao analisar token: ${error.message}`, true);
            } finally {
                toggleLoading(false);
            }
        }

        // Fun√ß√£o para buscar informa√ß√µes do token para an√°lise global
        async function getGlobalTokenInfo(chainKey, tokenAddress) {
            try {
                // Usar o mesmo m√©todo da an√°lise de carteira, mas sem carteira espec√≠fica
                const url = buildApiUrl(chainKey, 'token', 'tokeninfo', {
                    contractaddress: tokenAddress
                });
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === '1' && data.result && data.result.length > 0) {
                    const tokenInfo = data.result[0];
                    currentTokenInfo = {
                        name: tokenInfo.tokenName || 'Token Desconhecido',
                        symbol: tokenInfo.symbol || 'UNKNOWN',
                        decimals: parseInt(tokenInfo.divisor) || 18,
                        contractAddress: tokenAddress,
                        totalSupply: tokenInfo.totalSupply || '0'
                    };
                    
                    addDebugInfo('‚úÖ Informa√ß√µes do token obtidas', currentTokenInfo, 'token');
                } else {
                    // Fallback: tentar obter via transa√ß√µes
                    addDebugInfo('üîÑ Tentando obter info via transa√ß√µes...', null, 'token');
                    const txUrl = buildApiUrl(chainKey, 'account', 'tokentx', {
                        contractaddress: tokenAddress,
                        page: 1,
                        offset: 1,
                        sort: 'desc'
                    });
                    
                    const txResponse = await fetch(txUrl);
                    const txData = await txResponse.json();
                    
                    if (txData.status === '1' && txData.result && txData.result.length > 0) {
                        const firstTx = txData.result[0];
                        currentTokenInfo = {
                            name: firstTx.tokenName || 'Token Desconhecido',
                            symbol: firstTx.tokenSymbol || 'UNKNOWN',
                            decimals: parseInt(firstTx.tokenDecimal) || 18,
                            contractAddress: tokenAddress,
                            totalSupply: '0'
                        };
                        
                        addDebugInfo('‚úÖ Info obtida via transa√ß√µes', currentTokenInfo, 'token');
                    } else {
                        // Fallback final
                        currentTokenInfo = {
                            name: 'Token Desconhecido',
                            symbol: 'TOKEN',
                            decimals: 18,
                            contractAddress: tokenAddress,
                            totalSupply: '0'
                        };
                        
                        addDebugInfo('‚ö†Ô∏è Usando informa√ß√µes padr√£o', currentTokenInfo, 'warning');
                    }
                }
            } catch (error) {
                addDebugInfo('‚ùå Erro ao obter informa√ß√µes do token', { error: error.message }, 'error');
                throw error;
            }
        }

        // Fun√ß√£o para buscar TODAS as transa√ß√µes de um token
        async function fetchAllTokenTransactions(chainKey, contractAddress) {
            const allTransactions = [];
            let page = 1;
            const maxPages = 10; // Limitar para evitar sobrecarga
            
            try {
                while (page <= maxPages) {
                    addDebugInfo(`üìÑ Buscando p√°gina ${page} de transa√ß√µes...`, null, 'api');
                    
                    const url = buildApiUrl(chainKey, 'account', 'tokentx', {
                        contractaddress: contractAddress,
                        startblock: 0,
                        endblock: 99999999,
                        page: page,
                        offset: 1000,
                        sort: 'desc'
                    });
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.status === '1' && data.result && data.result.length > 0) {
                        allTransactions.push(...data.result);
                        addDebugInfo(`‚úÖ P√°gina ${page}: ${data.result.length} transa√ß√µes`, null, 'data');
                        
                        // Se retornou menos que 1000, √© a √∫ltima p√°gina
                        if (data.result.length < 1000) {
                            break;
                        }
                        page++;
                    } else {
                        addDebugInfo(`‚ö†Ô∏è P√°gina ${page}: sem dados`, { message: data.message }, 'warning');
                        break;
                    }
                    
                    // Pequena pausa para n√£o sobrecarregar a API
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                addDebugInfo('üìä Coleta de transa√ß√µes conclu√≠da', { 
                    totalTransactions: allTransactions.length,
                    pagesProcessed: page - 1
                }, 'success');
                
                return allTransactions;
                
            } catch (error) {
                addDebugInfo('‚ùå Erro ao buscar transa√ß√µes', { error: error.message }, 'error');
                throw error;
            }
        }

        // Fun√ß√£o para processar an√°lise global do token
        function processGlobalTokenAnalysis(transactions, contractAddress) {
            addDebugInfo('‚öôÔ∏è Processando an√°lise global...', { count: transactions.length }, 'data');
            
            const analysis = {
                totalTransactions: transactions.length,
                totalVolumeIn: 0,
                totalVolumeOut: 0,
                uniqueHolders: new Set(),
                uniqueSenders: new Set(),
                largestTransaction: null,
                firstTransaction: null,
                lastTransaction: null,
                dailyVolume: {},
                topHolders: {},
                transactionsByDay: {}
            };
            
            const decimals = currentTokenInfo?.decimals || 18;
            let maxValue = 0;
            
            transactions.forEach(tx => {
                const value = parseFloat(tx.value) / Math.pow(10, decimals);
                const date = new Date(parseInt(tx.timeStamp) * 1000);
                const dateKey = date.toISOString().split('T')[0];
                
                // Volume total
                analysis.totalVolumeIn += value;
                
                // Holders √∫nicos
                analysis.uniqueHolders.add(tx.to.toLowerCase());
                analysis.uniqueSenders.add(tx.from.toLowerCase());
                
                // Maior transa√ß√£o
                if (value > maxValue) {
                    maxValue = value;
                    analysis.largestTransaction = { ...tx, formattedValue: value };
                }
                
                // Primeira e √∫ltima transa√ß√£o
                if (!analysis.firstTransaction || parseInt(tx.timeStamp) < parseInt(analysis.firstTransaction.timeStamp)) {
                    analysis.firstTransaction = tx;
                }
                if (!analysis.lastTransaction || parseInt(tx.timeStamp) > parseInt(analysis.lastTransaction.timeStamp)) {
                    analysis.lastTransaction = tx;
                }
                
                // Volume por dia
                if (!analysis.dailyVolume[dateKey]) {
                    analysis.dailyVolume[dateKey] = 0;
                    analysis.transactionsByDay[dateKey] = 0;
                }
                analysis.dailyVolume[dateKey] += value;
                analysis.transactionsByDay[dateKey]++;
                
                // Top holders (aproximado)
                if (!analysis.topHolders[tx.to.toLowerCase()]) {
                    analysis.topHolders[tx.to.toLowerCase()] = 0;
                }
                analysis.topHolders[tx.to.toLowerCase()] += value;
            });
            
            // Converter sets para arrays e contar
            analysis.uniqueHoldersCount = analysis.uniqueHolders.size;
            analysis.uniqueSendersCount = analysis.uniqueSenders.size;
            
            // Ordenar top holders
            analysis.topHoldersArray = Object.entries(analysis.topHolders)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10)
                .map(([address, volume]) => ({ address, volume }));
            
            addDebugInfo('‚úÖ An√°lise global processada', {
                totalVolume: analysis.totalVolumeIn.toFixed(6),
                uniqueHolders: analysis.uniqueHoldersCount,
                largestTx: maxValue.toFixed(6)
            }, 'success');
            
            globalTokenAnalysis = analysis;
            return analysis;
        }

        // Fun√ß√£o para exibir resultados da an√°lise global
        function displayGlobalTokenResults(analysis) {
            // Atualizar cards de resumo com dados globais
            document.getElementById('totalTx').textContent = analysis.totalTransactions;
            document.getElementById('totalVolume').textContent = `${analysis.totalVolumeIn.toFixed(6)} ${currentTokenInfo?.symbol || 'TOKEN'}`;
            document.getElementById('avgValue').textContent = `${(analysis.totalVolumeIn / analysis.totalTransactions).toFixed(6)} ${currentTokenInfo?.symbol || 'TOKEN'}`;
            
            if (analysis.lastTransaction) {
                const lastTxTime = new Date(parseInt(analysis.lastTransaction.timeStamp) * 1000);
                document.getElementById('lastTx').textContent = getTimeAgo(lastTxTime);
            }
            
            // Atualizar an√°lise de fluxo para dados globais
            const tokenName = currentTokenInfo?.name || 'Token Desconhecido';
            const symbol = currentTokenInfo?.symbol || 'TOKEN';
            
            document.getElementById('flowAnalysisTitle').innerHTML = `
                <svg class="w-8 h-8 text-purple-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                An√°lise Global - ${tokenName} (${symbol})
                <span class="text-sm text-gray-400 ml-2">Todas as Transa√ß√µes</span>
            `;
            
            document.getElementById('incomingTitle').textContent = `${symbol} - Volume Total Global`;
            document.getElementById('outgoingTitle').textContent = `${symbol} - Holders √önicos`;
            document.getElementById('netBalanceTitle').textContent = `${symbol} - Maior Transa√ß√£o`;
            
            // Dados globais
            document.getElementById('incomingCount').textContent = analysis.totalTransactions;
            document.getElementById('incomingVolume').textContent = `${analysis.totalVolumeIn.toFixed(6)} ${symbol}`;
            document.getElementById('outgoingCount').textContent = analysis.uniqueHoldersCount;
            document.getElementById('outgoingVolume').textContent = `${analysis.uniqueSendersCount} remetentes √∫nicos`;
            
            const netBalanceElement = document.getElementById('netBalance');
            if (analysis.largestTransaction) {
                netBalanceElement.textContent = `${analysis.largestTransaction.formattedValue.toFixed(6)} ${symbol}`;
                netBalanceElement.className = 'text-3xl font-bold text-purple-400';
            }
            
            // Renderizar tabela com transa√ß√µes mais recentes
            // Usar as transa√ß√µes originais que foram processadas
            const allTx = globalTokenAnalysis ? Object.values(globalTokenAnalysis) : [];
            currentTransactions = allTx.length > 50 ? allTx.slice(0, 50) : allTx;
            
            addDebugInfo('üìä Resultados globais exibidos', {
                displayedTransactions: Math.min(50, analysis.totalTransactions)
            }, 'success');
        }

        // Event Listeners para Modo de An√°lise
        document.getElementById('walletModeCard').addEventListener('click', function() {
            switchAnalysisMode('wallet');
        });

        document.getElementById('contractModeCard').addEventListener('click', function() {
            switchAnalysisMode('contract');
        });

        // Event Listeners
        analyzeBtn.addEventListener('click', function() {
            if (analysisMode === 'wallet') {
                analyzeTransactions();
            } else {
                analyzeGlobalToken();
            }
        });
        document.getElementById('exportBtn').addEventListener('click', exportToCSV);

        // Event Listeners para A√ß√µes R√°pidas
        document.getElementById('copyContractBtn').addEventListener('click', function() {
            const contractAddress = document.getElementById('contractAddress').textContent;
            navigator.clipboard.writeText(contractAddress).then(() => {
                this.textContent = 'Copiado!';
                setTimeout(() => this.textContent = 'Copiar', 2000);
            });
        });

        document.getElementById('copyWalletBtn').addEventListener('click', function() {
            const walletAddress = document.getElementById('walletAddress').textContent;
            navigator.clipboard.writeText(walletAddress).then(() => {
                this.textContent = 'Copiado!';
                setTimeout(() => this.textContent = 'Copiar', 2000);
            });
        });

        document.getElementById('refreshAnalysisBtn').addEventListener('click', function() {
            analyzeTransactions();
        });

        document.getElementById('exportDataBtn').addEventListener('click', function() {
            exportToCSV();
        });

        document.getElementById('shareAnalysisBtn').addEventListener('click', function() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link da an√°lise copiado para a √°rea de transfer√™ncia!');
            });
        });

        document.getElementById('newAnalysisBtn').addEventListener('click', function() {
            if (confirm('Deseja iniciar uma nova an√°lise? Os dados atuais ser√£o perdidos.')) {
                location.reload();
            }
        });

        // Event Listeners para Portfolio
        document.getElementById('refreshPortfolioBtn').addEventListener('click', function() {
            fetchWalletPortfolio();
        });

        document.getElementById('exportPortfolioBtn').addEventListener('click', function() {
            exportPortfolio();
        });

        document.getElementById('sortByValueBtn').addEventListener('click', function() {
            currentPortfolio.sort((a, b) => b.valueUSD - a.valueUSD);
            displayPortfolio();
        });

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            initializeDates();
            addDebugInfo('üöÄ Wallex inicializado', {
                supportedNetworks: Object.keys(CHAIN_CONFIG).length,
                apiKeyIntegrated: true,
                debugMode: debugMode,
                version: 'PRO'
            }, 'success');
        });
    </script>

</body>
</html>
